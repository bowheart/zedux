
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Store Composition Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="configuringTheHierarchy.html" />
    
    
    <link rel="prev" href="harnessingStateMachines.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../overview.html">
            
                <a href="../overview.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../examples.html">
            
                <a href="../examples.html">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="./">
            
                <a href="./">
            
                    
                    Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="reactUsage.html">
            
                <a href="reactUsage.html">
            
                    
                    React Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="theReducerLayer.html">
            
                <a href="theReducerLayer.html">
            
                    
                    The Reducer Layer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="theProcessorLayer.html">
            
                <a href="theProcessorLayer.html">
            
                    
                    The Processor Layer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="theInspectorLayer.html">
            
                <a href="theInspectorLayer.html">
            
                    
                    The Inspector Layer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="zeroConfiguration.html">
            
                <a href="zeroConfiguration.html">
            
                    
                    Zero Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="dispatchableReducers.html">
            
                <a href="dispatchableReducers.html">
            
                    
                    Dispatchable Reducers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="harnessingStateMachines.html">
            
                <a href="harnessingStateMachines.html">
            
                    
                    Harnessing State Machines
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.8" data-path="storeComposition.html">
            
                <a href="storeComposition.html">
            
                    
                    Store Composition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="configuringTheHierarchy.html">
            
                <a href="configuringTheHierarchy.html">
            
                    
                    Configuring the Hierarchy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="mergingHierarchies.html">
            
                <a href="mergingHierarchies.html">
            
                    
                    Merging Hierarchies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="metaChains.html">
            
                <a href="metaChains.html">
            
                    
                    Meta Chains
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="optimizingPerformance.html">
            
                <a href="optimizingPerformance.html">
            
                    
                    Optimizing Performance
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../api/">
            
                <a href="../api/">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../api/act.html">
            
                <a href="../api/act.html">
            
                    
                    act
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../api/act.namespace.html">
            
                <a href="../api/act.namespace.html">
            
                    
                    act.namespace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../api/actionTypes.html">
            
                <a href="../api/actionTypes.html">
            
                    
                    actionTypes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../api/createStore.html">
            
                <a href="../api/createStore.html">
            
                    
                    createStore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../api/metaTypes.html">
            
                <a href="../api/metaTypes.html">
            
                    
                    metaTypes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../api/react.html">
            
                <a href="../api/react.html">
            
                    
                    react
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../api/select.html">
            
                <a href="../api/select.html">
            
                    
                    select
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../api/state.html">
            
                <a href="../api/state.html">
            
                    
                    state
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../api/transition.html">
            
                <a href="../api/transition.html">
            
                    
                    transition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../api/Store.html">
            
                <a href="../api/Store.html">
            
                    
                    Store
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../api/ZeduxActor.html">
            
                <a href="../api/ZeduxActor.html">
            
                    
                    ZeduxActor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../api/ZeduxMachine.html">
            
                <a href="../api/ZeduxMachine.html">
            
                    
                    ZeduxMachine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../api/ZeduxReactor.html">
            
                <a href="../api/ZeduxReactor.html">
            
                    
                    ZeduxReactor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../api/ZeduxState.html">
            
                <a href="../api/ZeduxState.html">
            
                    
                    ZeduxState
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../types/">
            
                <a href="../types/">
            
                    
                    Types
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../types/Action.html">
            
                <a href="../types/Action.html">
            
                    
                    Action
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../types/ActionCreator.html">
            
                <a href="../types/ActionCreator.html">
            
                    
                    ActionCreator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../types/Actor.html">
            
                <a href="../types/Actor.html">
            
                    
                    Actor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../types/Branch.html">
            
                <a href="../types/Branch.html">
            
                    
                    Branch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../types/Dispatchable.html">
            
                <a href="../types/Dispatchable.html">
            
                    
                    Dispatchable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../types/HierarchyDescriptor.html">
            
                <a href="../types/HierarchyDescriptor.html">
            
                    
                    HierarchyDescriptor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../types/Inducer.html">
            
                <a href="../types/Inducer.html">
            
                    
                    Inducer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../types/Inspector.html">
            
                <a href="../types/Inspector.html">
            
                    
                    Inspector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../types/MetaChainNode.html">
            
                <a href="../types/MetaChainNode.html">
            
                    
                    MetaChainNode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../types/MetaNode.html">
            
                <a href="../types/MetaNode.html">
            
                    
                    MetaNode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../types/NodeOptions.html">
            
                <a href="../types/NodeOptions.html">
            
                    
                    NodeOptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../types/Processor.html">
            
                <a href="../types/Processor.html">
            
                    
                    Processor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../types/Reactor.html">
            
                <a href="../types/Reactor.html">
            
                    
                    Reactor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../types/Reducer.html">
            
                <a href="../types/Reducer.html">
            
                    
                    Reducer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../types/Selector.html">
            
                <a href="../types/Selector.html">
            
                    
                    Selector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../types/State.html">
            
                <a href="../types/State.html">
            
                    
                    State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../types/StoreBase.html">
            
                <a href="../types/StoreBase.html">
            
                    
                    StoreBase
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../types/Subscription.html">
            
                <a href="../types/Subscription.html">
            
                    
                    Subscription
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../glossary.html">
            
                <a href="../glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../shapeRelationProblems.html">
            
                <a href="../shapeRelationProblems.html">
            
                    
                    Shape Relation Problems
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Store Composition</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="store-composition">Store Composition</h1>
<p>This is easily the coolest part of Zedux. The store composition model of Zedux is unprecedented and extremely powerful.</p>
<p>In this guide, we&apos;ll start off talking about the concepts of store composition at a very high level (complete with pictures!). We&apos;ll then translate our high level examples into real Zedux stores.</p>
<p>This guide will assume you&apos;re at least moderately familiar with the <a href="theInspectorLayer.html">inspector layer</a> of Zedux stores. So read up on that if you haven&apos;t.</p>
<h2 id="behold-the-awesomeness">Behold the awesomeness</h2>
<p>Let&apos;s work with the following store setup:</p>
<p><img src="../img/store-composition-setup.png" alt="Zedux store composition setup"></p>
<blockquote>
<p>To be clear, this means that Store A and Store B appear <em>somewhere</em> in the <a href="../types/HierarchyDescriptor.html">Hierarchy Descriptor</a> of the Root Store, and Store C appears <em>somewhere</em> in the Hierarchy Descriptor of Store B.</p>
</blockquote>
<p>Hopefully your mind is reeling right now. Here are a few questions we&apos;ll answer in this guide:</p>
<ul>
<li>&quot;What happens if I dispatch an action to the Root Store? Store A? B? C?&quot;</li>
<li>&quot;How does the Root Store know of a change in Store C?&quot;</li>
<li>&quot;What if I dispatch an <a href="../types/Inducer.html">inducer</a> to the Root Store?&quot;</li>
<li>&quot;What if I hydrate the state of Store B?&quot;</li>
<li>&quot;How can time travel debugging possibly still work?&quot;</li>
</ul>
<p>Let&apos;s get this party started.</p>
<h2 id="what-happens-if-i-dispatch-an-action-to-the-root-store">What happens if I dispatch an action to the Root Store?</h2>
<p>Zedux wraps all child stores in <a href="../types/Reactor.html">reactors</a>. Thus an action dispatched to the Root Store will find its way down the reactor hierarchy to each child store&apos;s wrapper reactor.</p>
<p>When a child store&apos;s wrapper reactor is hit, it dispatches a special <code>INHERIT</code> action to the child store. This <code>INHERIT</code> action is just the original action wrapped in a <a href="../types/MetaNode.html">meta node</a>. Let&apos;s get some visuals:</p>
<p><img src="../img/action-to-parent-store.png" alt="action dispatched to root store"></p>
<blockquote>
<p>We&apos;ll use red arrows to indicate downward flow and a red box to indicate that an action is wrapped in the <a href="../api/metaTypes.html#inherit">special <code>INHERIT</code> meta type</a>.</p>
</blockquote>
<p>These wrapped actions behave exactly like normal actions, except that the child store&apos;s inspectors can see that the action is inherited. Zedux uses this internally to ensure that the action doesn&apos;t propagate back up the chain. But most inspector tasks will want to ignore inherited actions.</p>
<p>Good so far? Let&apos;s continue.</p>
<h2 id="what-happens-if-i-dispatch-an-action-to-store-a">What happens if I dispatch an action to Store A?</h2>
<p>Hmm. Let&apos;s think about this. The Root Store&apos;s inspectors need to be notified of the action so that it can implement time travel debugging. The action should be dispatched to Store A normally. If Store A&apos;s state changes, the Root Store also needs to be notified of that state change. The Root Store then needs to propagate that change through its own internal state and notify its own subscribers of the change.</p>
<p>Thus there are two things the Root Store needs to do:</p>
<h3 id="1-inspect-store-as-actions">1) Inspect Store A&apos;s actions</h3>
<p>Parent stores register an <a href="../types/Inspector.html">inspector</a> with their child stores. When an action is dispatched to a child store, the parent&apos;s inspector is notified and propagates the notification to the parent store&apos;s inspectors. And so on up the chain.</p>
<p>The key here is that the parent store wraps the action in a special <code>DELEGATE</code> meta node before passing it up the chain. This meta node contains all the information the parent store needs to &quot;delegate&quot; the action to the child store. The idea here is that dispatching an action to a child store is <strong>exactly</strong> equivalent to dispatching a configured <code>DELEGATE</code> action to the parent store.</p>
<p>This allows the Root Store to plug in to all actions dispatched to all child stores in such a way that the Root Store can easily reproduce all state changes across the whole hierarchy. Since this is recursive, even deeply nested stores can have their state easily reproduced by any store up the chain (including itself). This is the key to time travel.</p>
<p>Note that the action is not dispatched to the parent store. Only the inspectors of the parent store (and grandparent store, and great-grandparent store, etc...) are notified.</p>
<h3 id="2-subscribe-to-changes-in-store-a">2) Subscribe to changes in Store A</h3>
<p>Parent stores also subscribe to changes in their child stores. When a child&apos;s state changes, the parent reconstructs the state hierarchy down the child store&apos;s path (that&apos;s just basic immutability). The parent store then notifies its subscribers of the state change. And so on up the chain.</p>
<p><img src="../img/action-to-child-store.png" alt="action dispatched to child store"></p>
<blockquote>
<p>We&apos;ll use green arrows to indicate upward flow and a green box to indicate that an action is wrapped in the <a href="../api/metaTypes.html#delegate">special <code>DELEGATE</code> meta type</a>.</p>
</blockquote>
<p>Note that Store B and Store C are not touched in the slightest. This is the beastly performance benefit of Zedux.</p>
<h2 id="what-happens-if-i-dispatch-an-action-to-store-b">What happens if I dispatch an action to Store B?</h2>
<p>Now we&apos;re getting somewhere. Take a wild guess at what happens in this case.</p>
<p>This case is just a combination of the two previous examples:</p>
<p><img src="../img/action-to-middle-store.png" alt="action dispatched to middle store"></p>
<p>Note again that Store A is not touched. Beautiful.</p>
<h2 id="what-happens-if-i-dispatch-an-action-to-store-c">What happens if I dispatch an action to Store C?</h2>
<p>Ooh. This part&apos;s fun. If you were paying attention, you should already know what happens in this case. But this diagram is just too fun:</p>
<p><img src="../img/action-to-grandchild-store.png" alt="action dispatched to grandchild store"></p>
<p>Remember the key to time travel:</p>
<blockquote>
<p>The idea here is that dispatching an action to a child store is <strong>exactly</strong> equivalent to dispatching a configured <code>DELEGATE</code> action to the parent store.</p>
</blockquote>
<p>The same goes for grandchild and great-grandchild stores (and so on...). An action dispatched to a store is <strong>exactly</strong> equivalent to dispatching a configured <code>DELEGATE</code> action to its parent store. It&apos;s also <strong>exactly</strong> equivalent to dispatching a doubly-wrapped <code>DELEGATE</code> action to its grandparent store or a triply-wrapped <code>DELEGATE</code> action to its great-grandparent store. And so on forever.</p>
<p>Zedux takes special care to ensure that every store can reproduce every last bit of its state.</p>
<h2 id="unwinding">Unwinding</h2>
<p>Let&apos;s dispatch a doubly-wrapped <code>DELEGATE</code> action to the Root Store and see what happens:</p>
<p><img src="../img/wrapped-action-to-parent-store.png" alt="doubly wrapped delegate action dispatched to Root Store"></p>
<p>Let&apos;s walk through this one:</p>
<ul>
<li><p>[action dispatched to Root Store]</p>
</li>
<li><p>Root Store: &quot;Oh, delegate to Store B, huh? You got it.&quot;</p>
</li>
<li><p>[Root Store unwraps the &quot;delegate&quot; instruction and dispatches the result to Store B]</p>
</li>
<li><p>Store B: &quot;Oh, delegate to Store C, huh? Fine...&quot;</p>
</li>
<li><p>[Store B unwraps the &quot;delegate&quot; instruction and dispatches the result to Store C]</p>
</li>
<li><p>Store C: &quot;Oh look, a normal action. Inform my inspectors! Call out the reducers and hit up the processors! Long live Zedux!&quot;</p>
</li>
</ul>
<p>Note that the action is dispatched to Store C normally. Store C has no idea where it came from. Thus the action will actually travel back up the inspector chain, being wrapped in <code>DELEGATE</code> meta nodes as normal.</p>
<p>Also note that Store A is still completely untouched. Ah, Zedux.</p>
<h2 id="how-does-the-root-store-know-of-a-change-in-store-c">How does the Root Store know of a change in Store C?</h2>
<p>We&apos;ve answered this one. Recall:</p>
<blockquote>
<p>Parent stores also subscribe to changes in their child stores. When a child&apos;s state changes, the parent reconstructs the state hierarchy down the child store&apos;s path (that&apos;s just basic immutability). The parent store then notifies its subscribers of the state change. And so on up the chain.</p>
</blockquote>
<p>Thus state changes in a child store are propagated up to parent store subscriptions. I think a simple image will suffice:</p>
<p><img src="../img/state-propagation.png" alt="state propagation"></p>
<h2 id="what-if-i-dispatch-an-inducer-to-the-root-store">What if I dispatch an <a href="../types/Inducer.html">inducer</a> to the Root Store?</h2>
<p>Since an inducer is essentially just a partial state hydration &#x2013; in fact, an inducer causes the special <a href="../api/actionTypes.html#hydrate">hydrate</a> action to be dispatched &#x2013; we&apos;ll answer this question with the next one.</p>
<blockquote>
<p>Note that when an inducer is dispatched to a parent store, the state update loses its advantage of being an O(1) operation; the parent store will still send the action through its reducer and processor layers in order to inform its child stores of the state update.</p>
</blockquote>
<h2 id="what-if-i-hydrate-the-state-of-store-b">What if I hydrate the state of Store B?</h2>
<p>The hydration will create the special <a href="../api/actionTypes.html#hydrate">hydrate</a> action, wrap it in a <code>DELEGATE</code> meta node, and inform the Root Store&apos;s inspectors. During hydration, Store C will also be hydrated with the appropriate slice of state. Once the state is updated, the state change in Store B will be propagated to the Root Store.</p>
<p><img src="../img/middle-store-hydration.png" alt="middle store hydration"></p>
<p>And so on down and up the chain. Sick, huh?</p>
<h2 id="how-can-time-travel-debugging-possibly-still-work">How can time travel debugging possibly still work?</h2>
<p>We&apos;ve probably answered this satisfactorily, but just to review:</p>
<p>Zedux takes special care to make sure that a store&apos;s inspectors are called every time the store&apos;s state may change. So <a href="../api/Store.html#storehydrate"><code>store.hydrate()</code></a>, <a href="../types/Inducer.html">inducers</a>, and actions dispatched to child stores will all find a way to notify the store&apos;s inspectors of a serializable action that can be used to reproduce the state update.</p>
<p>Typically, time travel will be implemented in the Root Store&apos;s inspectors. But every store has the capability.</p>
<h2 id="with-code">With code</h2>
<p>Let&apos;s demonstrate a couple of these scenarios with actual Zedux code. We&apos;ll make Store A and Store C (our &quot;leaf&quot; nodes) use a simple counter reducer as their root reactor:</p>
<h3 id="reducerscounterjs"><code>reducers/counter.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> act<span class="token punctuation">,</span> react <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;zedux&apos;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">act</span><span class="token punctuation">(</span><span class="token string">&apos;increment&apos;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">react</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>increment<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withReducers</span><span class="token punctuation">(</span>state <span class="token operator">=</span><span class="token operator">&gt;</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<p>Now let&apos;s create Store A:</p>
<h3 id="storesstoreajs"><code>stores/storeA.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;zedux&apos;</span>
<span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">&apos;../reducers/counter&apos;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    counterA<span class="token punctuation">:</span> counter
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>And Store C (basically the same thing):</p>
<h3 id="storesstorecjs"><code>stores/storeC.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;zedux&apos;</span>
<span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">&apos;../reducers/counter&apos;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    counterC<span class="token punctuation">:</span> counter
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Let&apos;s make Store B a little more interesting. We&apos;ll nest Store C deep (alright, not too deep) in Store B&apos;s hierarchy descriptor:</p>
<h3 id="storesstorebjs"><code>stores/storeB.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;zedux&apos;</span>
<span class="token keyword">import</span> storeC <span class="token keyword">from</span> <span class="token string">&apos;./storeC&apos;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    nested<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">:</span> storeC
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Now let&apos;s glue it all together in our Root Store:</p>
<h3 id="storesrootstorejs"><code>stores/rootStore.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;zedux&apos;</span>
<span class="token keyword">import</span> storeA <span class="token keyword">from</span> <span class="token string">&apos;./storeA&apos;</span>
<span class="token keyword">import</span> storeB <span class="token keyword">from</span> <span class="token string">&apos;./storeB&apos;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> storeA<span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> storeB
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Sweet! Let&apos;s take it for a spin:</p>
<h3 id="indexjs"><code>index.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> rootStore <span class="token keyword">from</span> <span class="token string">&apos;./stores/rootStore&apos;</span>

rootStore<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">/* -&gt;
  {
    a: {
      counterA: 0
    },
    b: {
      nested: {
        store: {
          counterC: 0
        }
      }
    }
  }
*/</span>
</code></pre>
<p>Before we get too crazy, let&apos;s register an inspector with the Root Store and Store B and let&apos;s subscribe to changes on the Root Store:</p>
<h3 id="indexjs"><code>index.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> rootStore <span class="token keyword">from</span> <span class="token string">&apos;./stores/rootStore&apos;</span>
<span class="token keyword">import</span> storeB <span class="token keyword">from</span> <span class="token string">&apos;./stores/storeB&apos;</span>

rootStore<span class="token punctuation">.</span><span class="token function">inspect</span><span class="token punctuation">(</span><span class="token punctuation">(</span>storeBase<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Root Store inspector received action&apos;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

rootStore<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>newState<span class="token punctuation">,</span> oldState<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Root Store state updated&apos;</span><span class="token punctuation">,</span> newState<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

storeB<span class="token punctuation">.</span><span class="token function">inspect</span><span class="token punctuation">(</span><span class="token punctuation">(</span>storeBase<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Store B inspector received action&apos;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Now we can go crazy:</p>
<h3 id="crazyjs"><code>crazy.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> increment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./reducers/counter&apos;</span>
<span class="token keyword">import</span> rootStore <span class="token keyword">from</span> <span class="token string">&apos;./stores/rootStore&apos;</span>

rootStore<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">/*
  Logs:

  Root Store inspector received action {
    type: &apos;increment&apos;
  }

  Store B inspector received action {
    metaType: &apos;@@zedux/inherit&apos;,
    action: {
      type: &apos;increment&apos;
    }
  }

  Root Store state updated {
    a: {
      counterA: 1
    },
    b: {
      nested: {
        store: {
          counterC: 1
        }
      }
    }
  }
*/</span>
</code></pre>
<blockquote>
<p>We simplified these logs. There will actually be another log and the Store B log will actually have another meta node on it. Store B&apos;s inspectors receive an inherited action from the Root Store&apos;s reducer layer <em>and</em> an inherited action from the Root Store&apos;s processor layer. Usually you&apos;ll want to just ignore inherited actions.</p>
</blockquote>
<p>How about an action dispatched to Store C?</p>
<h3 id="crazy2js"><code>crazy2.js</code></h3>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> increment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./reducers/counter&apos;</span>
<span class="token keyword">import</span> storeC <span class="token keyword">from</span> <span class="token string">&apos;./stores/storeC&apos;</span>

storeC<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">/*
  Logs:

  Store B inspector received action {
    metaType: &apos;@@zedux/delegate&apos;,
    metaPayload: [ &apos;nested&apos;, &apos;store&apos; ],
    action: {
      type: &apos;increment&apos;
    }
  }

  Root Store inspector received action {
    metaType: &apos;@@zedux/delegate&apos;,
    metaPayload: [ &apos;b&apos; ],
    action: {
      metaType: &apos;@@zedux/delegate&apos;,
      metaPayload: [ &apos;nested&apos;, &apos;store&apos; ],
      action: {
        type: &apos;increment&apos;
      }
    }
  }

  Root Store state updated {
    a: {
      counterA: 1
    },
    b: {
      nested: {
        store: {
          counterC: 2
        }
      }
    }
  }
*/</span>
</code></pre>
<blockquote>
<p>We simplified these logs too. To see the real output, play with <a href="https://codepen.io/bowheart/pen/eyWaaz?editors=0010" target="_blank">this codepen</a>.</p>
</blockquote>
<p>Here you can see the nested <code>DELEGATE</code> meta nodes and their data.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Well, that was fun. There are plenty of other scenarios we didn&apos;t get to, but this should shed enough light on the store composition model of Zedux to get you started. The store setup we used here is all ready to go in <a href="https://codepen.io/bowheart/pen/eyWaaz?editors=0010" target="_blank">this codepen</a> if you want to have a fiddle.</p>
<p>Apart from the obvious performance benefits, we didn&apos;t really cover the motivation behind composable stores. That&apos;ll have to wait for another article. For now, I hope you can see that the store tree more closely resembles a component hierarchy in Redux, Vue, Angular, or other such component-based libraries. The ability to create stores whose lifecycle parallels the lifecycle of a component while still maintaining time-traversable state and replayable actions is an exciting new possibility that Zedux has blown wide open.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="harnessingStateMachines.html" class="navigation navigation-prev " aria-label="Previous page: Harnessing State Machines">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="configuringTheHierarchy.html" class="navigation navigation-next " aria-label="Next page: Configuring the Hierarchy">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Store Composition","level":"1.4.8","depth":2,"next":{"title":"Configuring the Hierarchy","level":"1.4.9","depth":2,"path":"docs/guides/configuringTheHierarchy.md","ref":"docs/guides/configuringTheHierarchy.md","articles":[]},"previous":{"title":"Harnessing State Machines","level":"1.4.7","depth":2,"path":"docs/guides/harnessingStateMachines.md","ref":"docs/guides/harnessingStateMachines.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["-highlight","prism","anchorjs"],"pluginsConfig":{"prism":{},"anchorjs":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"./docs/styles/website.css"}},"file":{"path":"docs/guides/storeComposition.md","mtime":"2018-02-11T23:05:36.590Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-21T20:42:33.166Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

